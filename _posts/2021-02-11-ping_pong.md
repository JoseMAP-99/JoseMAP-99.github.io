# Pong Game

Para el desarrollo de esta práctica se ha solicitado la realización de una versión similar al videojuego de los 70 llamado *Pong* (figura 1). 

![](/images/ping_pong/pong_original.png "Fig. 1: Interfaz del juego original")

1. TOC
{:toc}

## Introducción

*Pong* es un videojuego perteneciente a la primera generación de videoconsolas publicado por *Atari*, y está basado en el deporte de tenis de mesa razón por la cual, para su implementación en *Processing*, será necesario disponer de una mesa de juego dividida en dos, un marcador para dos jugadores, dos palas y una pelota. A diferencia del tenis de mesa, este videojuego mantiene su campo de juego cerrado, es decir, la pelota rebotará en las paredes laterales por lo que la pelota no podrá salir del campo a menos que uno de los dos jugadores falle su tirada. 

El objetivo del juego es conseguir el mayor número de puntos, lo cual se consigue cuando el oponente falla su tirada dejando la pelota salirse del campo de juego.

## Propuesta de diseño

El diseño original del *Pong* es el que se puede observar en la figura 1. Este diseño está constituido por un tablero horizontal de color negro dividido en dos por una línea blanca, dejando a cada lado una pala en forma vertical y su respectivo puntaje en la zona superior de cada campo de juego.

El diseño elegido para este proyecto es muy distinto al mencionado anteriormente, aunque respetando sus mecánicas de juego. El diseño elegido tiene su inspiración en las mesas de *Ping Pong* clásicas, con su característico color azul de fondo y palas rojas, empleando un divisor central en forma de red, y un sistema de puntaje que se ve reflejado en el campo de cada jugador. Además, la orientación del tablero se ha cambiado de horizontal a vertical con el objetivo de hacer más cómodo los controles de las palas, tal como se aprecia en la figura 2.

![](/images/ping_pong/ping_pong.PNG "Fig. 2: Diseño de interfaz desarrollado")

Puesto que la disposición del tablero es vertical, los controles de las palas están compuestos por teclas orientadas horizontalmente, tales como la tecla "A" y "D" para la pala superior, y el cursor "Izquierdo" y "Derecho" para la pala inferior. Además de estas teclas, también existen otras dos que cumplen determinadas funciones, como por ejemplo la tecla "P" para iniciar o pausar el juego, y la tecla "R" para reiniciar un juego. 

Finalmente, para que el juego sea más entretenido, se ha añadido un número de rondas a jugar que deberá ser proporcionado por el usuario.

## Recursos empleados

Para la realización de esta práctica se ha empleado *Processing*[^1], que se define como un lenguaje de programación y entorno de desarrollo integrado de código abierto basado en Java. Este lenguaje se ha empleado para el desarollo de forma local, sin embargo, para poder publicar el proyecto a través de internet es necesario emplear *p5.js*[^2], que se define como una librería *JavaScript* perteneciente al lado del cliente que posibilita la creación de experiencias interactivas y gráficas, basado en el núcleo de *Processing*.

Por tanto, el proyecto ha sido desarrollado enteramente en *Processing* y, dado que *p5.js* tiene su base en el primero, su respectiva conversión es simple. Para realizar esta conversión se he utilizado la herramienta online *HerokuApp*[^3].

Para que el videojuego sea más interactivo se han añadido tres tipos de sonidos, empleando la librería *processing.sound* en *Processing*, estos tres sonidos se corresponden con el choque de la pelota contra las paredes, el choque de la pelota contra las palas y, finalmente, un sonido cuando un jugador pierde. Estos sonidos fueron extraídos de la página *FesliyanStudios*[^4].

Para obtener el GIF del videojuego se optó por la librería *gifAnimation*, sin embargo, debido a problemas de lentitud en la captura de *frames*, se optó por obtener el GIF grabando la pantalla y pasándolo a dicho formato final.

Y, finalmente, para obtener datos introducidos por el usuario se ha empleado la librería *javax.swing*. El objetivo de su uso fue solicitar al usuario el número de rondas que desea jugar, además de mostrar un cartel informativo señalando el jugador ganador.

## Desarrollo del código 

A continuación se procederá a explicar el código realizado en *Processing*:

#### Variables empleadas
Para conseguir que el juego funcione adecuadamente, se han empleado una gran cantidad de variables, cada una con una respectiva función, tal y como se puede observar en el siguiente fragmento de código:

    //---------Especiales--------//
    SoundFile pingPong, knockBall, gameOver; //Variables para la reproducción de sonidos
    GifMaker gifFile; //Variable para la creación del GIF
    
    //---------Configuración de pantalla----------//
    int sizeX = 400; int sizeY = 500; //Dimensión de la ventana
    
    //---------Palas------//
    int supXPala, supYPala, infXPala, infYPala; //Posiciones X e Y de ambas palas
    int jump, sizePala; //Valocidad de movimiento de las palas, y longitud de ellas
    
    //---------Pelota--------//
    int cx, cy, radius; //Posición X e Y de la pelota, y radio de la misma
    int incY, incX, fastBall; //Incremento y velocidad de la pelota
    
    //------Configuración del campo de juego-------//
    int tableX, tableY, border; //Dimensiones de la zona de juego, tiene un borde que lo rodea
          
    //-------Variables de estado-------//
    boolean running; //Variable que señala si se está o no ejecutando el juego
    boolean pauseGame = true; //Variable que señala si el juego ha sido pausado o no
    boolean upWin; //Variable que señala qué jugador ha ganado el punto
    
    //---------Variables de pintado del puntaje----------//
    int middleX = (sizeX/2) + (sizeX/2)/2; //Variable de posición X común para el centrado del marcador    
    int middleYSup = (sizeY/2) - (sizeY/2)/2; //Variable de posición Y para el centrado del marcador superior   
    int middleYInf = (sizeY/2) + (sizeY/2)/2;  //Variable de posición Y para el centrado del marcador inferior

    //----------Variables especiales-------//
    int scoreSup, scoreInf; //Variables que almacenan el puntaje de los jugadores
    int randDir = -1; //Variable que alterna los saques de la pelota
    int rounds; //Variable que guarda el número de rondas elegido  
    
#### Función settings()

Esta función es necesaria si se desea tratar las dimensiones de la ventana como variables, puesto que esta función es ejecutada antes que la función *setup()*, consiguiendo así guardar las dimensiones de la ventana en variables para usos futuros.

    void settings() {
      size(sizeX, sizeY);
    }
    
### Función setup()



    void setup(){ 
      //Tablero
      border = 20;
      tableX = sizeX - (2*border);
      tableY = sizeY - (2*border);

      pingPong = new SoundFile(this, "sounds/ping-pong.mp3"); 
      gameOver = new SoundFile(this, "sounds/game-over.mp3"); 
      knockBall = new SoundFile(this, "sounds/knock-ball.mp3"); 

      gifFile = new GifMaker(this, "ping_pong.gif");
      gifFile.setRepeat(0);
    }

## Resultados obtenidos

A continuación se muestra la ejecución del videojuego, tanto en *Processing* como en *P5.js*.

| UI completa con Processing | UI reducida con P5.js |
| - | - |
| ![](/images/ping_pong/ping_pong.gif "Interfaz de usuario completa") | ![](/images/ping_pong/p5js_ping_pong.gif "Interfaz de usuario reducida") |

## Ejecución en vivo

{% include info.html text="Las teclas 'A' y 'D' controlan la pala superior, el curso 'Izquierdo' y 'Derecho' la pala inferior" %}
{% include alert.html text="La ejecución sólo está disponible para ordenadores" %}
{% include alert.html text="Se debe hacer 'click' sobre el recuadro del videojuego para poder jugarlo" %}

<div style="display: flex; justify-content: center">
  <iframe width="405" height="505" src="https://editor.p5js.org/JoseMAP-99/embed/DOoIYbaU1"></iframe>
</div>

El juego anterior es una versión acortada del juego original desarrollado, si desea jugar la versión completa, acceda al siguiente enlace:

{% include info.html text="Al abrir el enlace se le solicitará un número de rondas a jugar que deberá ser mayor que cero" %}

[Versión completa del juego](https://editor.p5js.org/JoseMAP-99/present/yk1-VJP5t)

## Referencias

[^1]: ["Página de consulta sobre *Processing*](https://processing.org/)
[^2]: ["Página de consulta sobre *p5.js*"](https://p5js.org/)
[^3]: ["Página de conversión *Processing* a *p5.js*"](https://pde2js.herokuapp.com/)
[^4]: ["Página de consulta sobre los sonidos"](https://www.fesliyanstudios.com/)
